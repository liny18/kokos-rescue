---
import { loadQuery } from "../sanity/lib/load-query";
import { urlForImage } from "../sanity/lib/urlForImage";
import Layout from "../layouts/Layout.astro";

interface Cat {
    name: string;
    age: number;
    description: string;
    photo: {
        asset: {
            _ref: string;
        };
    };
    instagramLink: string;
}

// Fetch cats data from Sanity
const { data: cats } = await loadQuery<Cat[]>({
    query: `*[_type == "cat"]{name, age, description, photo, instagramLink}`,
});
---

<Layout title="Our Cats">
    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 p-8">
        {
            cats.map((cat) => (
                <div class="relative bg-white rounded-lg shadow-md p-4">
                    <a
                        href={cat.instagramLink}
                        target="_blank"
                        class="block relative"
                    >
                        <img
                            src={urlForImage(cat.photo)
                                .width(400)
                                .height(300)
                                .url()}
                            alt={cat.name}
                            class="w-full h-auto rounded-lg mb-4"
                        />
                        <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 hover:opacity-100 transition-opacity duration-300 rounded-lg">
                            <span class="text-white text-lg font-semibold">
                                View on Instagram
                            </span>
                        </div>
                    </a>
                    <h2 class="text-xl font-bold mb-2">{cat.name}</h2>
                    <p class="text-gray-700 mb-2">Age: {cat.age}</p>
                    <div class="text-gray-700 mb-4 space-y-2">
                        {cat.description.split("\n").map((paragraph) => (
                            <p>{paragraph}</p>
                        ))}
                    </div>
                </div>
            ))
        }
    </section>
</Layout>
